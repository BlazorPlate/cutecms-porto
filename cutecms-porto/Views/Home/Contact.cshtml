@model Organization
@using System.Threading;
@using cutecms_porto.Areas.Identity.Models.DBModel;
@using cutecms_porto.Areas.Config.Models.DBModel;
@{
    ViewBag.Title = Resources.Resources.ContactUs;
    IdentityEntities identityDb = new IdentityEntities();
    ConfigEntities configDb = new ConfigEntities();
}
@section PageHeader
{
    <section class="page-header">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>@ViewBag.Title</h1>
                </div>
            </div>
        </div>
    </section>
    <div id="googlemaps" class="google-map"></div>
}
<!-- Google Maps - Go to the bottom of the page to change settings and map location. -->

<div class="container">
    <div class="row">
        <div class="col-md-6">

            <div class="alert alert-success hidden mt-lg" id="contactSuccess">
                <strong>Success!</strong> Your message has been sent to us.
            </div>

            <div class="alert alert-danger hidden mt-lg" id="contactError">
                <strong>Error!</strong> There was an error sending your message.
                <span class="font-size-xs mt-sm display-block" id="mailErrorMessage"></span>
            </div>

            <h2 class="mb-sm mt-sm"><strong>Contact</strong> Us</h2>
            <form id="contactForm" action="php/contact-form.php" method="POST">
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-6">
                            <label>Your name *</label>
                            <input type="text" value="" data-msg-required="Please enter your name." maxlength="100" class="form-control" name="name" id="name" required>
                        </div>
                        <div class="col-md-6">
                            <label>Your email address *</label>
                            <input type="email" value="" data-msg-required="Please enter your email address." data-msg-email="Please enter a valid email address." maxlength="100" class="form-control" name="email" id="email" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-12">
                            <label>Subject</label>
                            <input type="text" value="" data-msg-required="Please enter the subject." maxlength="100" class="form-control" name="subject" id="subject" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-12">
                            <label>Message *</label>
                            <textarea maxlength="5000" data-msg-required="Please enter your message." rows="10" class="form-control" name="message" id="message" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <input type="submit" value="Send Message" class="btn btn-primary btn-lg mb-xlg" data-loading-text="Loading...">
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-6">

            <h4 class="heading-primary mt-lg">Get in <strong>Touch</strong></h4>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur eget leo at velit imperdiet varius. In eu ipsum vitae velit congue iaculis vitae at risus. Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

            <hr>

            <h4 class="heading-primary">@Model.Name</h4>
            <ul class="list list-icons list-icons-style-3 mt-xlg">
                <li><i class="fa fa-map-marker"></i><p> @Model.AddressLine1<br />@Model.City,@Model.State,@Model.ZIP<br />@Model.Country</p></li>
                <li><i class="fa fa-phone"></i><span> @(Model.Telephone ?? Resources.Resources.NotAvailable)</span></li>
                <li><i class="fa fa-envelope"></i> <a href="mailto:@Model.Email">@(Model.Email ?? Resources.Resources.NotAvailable)</a></li>
            </ul>
            @{
                var query = from p in configDb.ConfigDepartments
                            join c in configDb.Contacts
                            on p.Id equals c.DepartmentId
                            where p.Contacts.Where(c => c.Organization.Language.CultureName.Trim().Equals(Thread.CurrentThread.CurrentCulture.Name)).Any()
                            select p;
            }
            @foreach (var item in query)
            {
                <h4 class="heading-primary">@(item.DepartmentTerms.Where(d => d.Language.CultureName.Trim().Equals(Thread.CurrentThread.CurrentCulture.Name) && d.DepartmentId == item.Id).FirstOrDefault()?.Value ?? item.Code)</h4>
                foreach (var contact in item.Contacts)
                {
                    <ul class="list list-icons list-icons-style-3 mt-xlg">
                        <li><i class="fa fa-user"></i><span> @string.Format(contact.PersonalTitle.PersonalTitleTerms.Where(p => p.Language.CultureName.Trim().Equals(Thread.CurrentThread.CurrentCulture.Name) && p.PersonalTitleId == contact.PersonalTitleId).FirstOrDefault().Value + " " + "{0}", @contact.Name), @contact.Position</span></li>
                        @foreach (var phoneNumber in contact.PhoneNumbers)
                        {
                            <li><i class="fa fa-phone"></i><span>@phoneNumber.Number, @Resources.Resources.Extension: @phoneNumber.Extension</span></li>
                        }
                        <li><i class="fa fa-map-marker"></i><span>@contact.Office</span></li>
                        <li><i class="fa fa-envelope"></i> <a href="mailto:@Model.Email">@(contact.Email ?? Resources.Resources.NotAvailable)</a></li>
                    </ul>
                }
            }
        </div>

    </div>
</div>
@section Scripts{

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <script>

        /*
        Map Settings

            Find the Latitude and Longitude of your address:
                - http://universimmedia.pagesperso-orange.fr/geo/loc.htm
                - http://www.findlatitudeandlongitude.com/find-address-from-latitude-and-longitude/

        */

        // Map Markers
        var mapMarkers = [{
            address: "New York, NY 10017",
            html: "<strong>New York Office</strong><br>New York, NY 10017",
            icon: {
                image: "assets/porto/img/pin.png",
                iconsize: [26, 46],
                iconanchor: [12, 46]
            },
            popup: true
        }];

        // Map Initial Location
        var initLatitude = 40.75198;
        var initLongitude = -73.96978;

        // Map Extended Settings
        var mapSettings = {
            controls: {
                draggable: (($.browser.mobile) ? false : true),
                panControl: true,
                zoomControl: true,
                mapTypeControl: true,
                scaleControl: true,
                streetViewControl: true,
                overviewMapControl: true
            },
            scrollwheel: false,
            markers: mapMarkers,
            latitude: initLatitude,
            longitude: initLongitude,
            zoom: 16
        };

        var map = $('#googlemaps').gMap(mapSettings);

        // Map Center At
        var mapCenterAt = function (options, e) {
            e.preventDefault();
            $('#googlemaps').gMap("centerAt", options);
        }

    </script>
}
